!function(t){var i=t.flood={},o=i.fill={},e=function(t,i){this.x=t,this.y=i};e.prototype.neighbours=function(){return[new e(this.x-1,this.y),new e(this.x+1,this.y),new e(this.x,this.y-1),new e(this.x,this.y+1)]},e.prototype.admissable=function(t){return this.x>=0&&this.x<t.columns&&this.y>=0&&this.y<t.rows};var s=function(){this.visitedPoints={}};s.prototype.visited=function(t){return this.visitedPoints[t.x]&&this.visitedPoints[t.x][t.y]},s.prototype.visit=function(t){this.visitedPoints[t.x]=this.visitedPoints[t.x]||{},this.visitedPoints[t.x][t.y]=!0};var n=o.Flooder=function(t){this.model=t};n.prototype.flood=function(t,i){for(var o=[new e(t,i)],n=0,h=new s,r=this.model.colorAt(t,i);n<o.length;){var f=o[n++];h.visited(f)||(h.visit(f),f.neighbours().filter(function(t){return t.admissable(this.model)&&this.model.colorAt(t.x,t.y)===r}.bind(this)).forEach(function(t){o.push(t)}))}o.forEach(function(t){this.model.paintPixel(t.x,t.y)}.bind(this))};var h=function(t,i,o){this.flooder=new n(t),this.model=t,this.view=i,this.canvas=o,this.boundReceiveFloodEvent=this.receiveFloodEvent.bind(this)};h.prototype.startDrawing=function(t){this.boundReceiveFloodEvent(t)},h.prototype.stopDrawing=function(){},h.prototype.receiveFloodEvent=function(t){var i=t.clientX-this.view.horizontalOffset-this.canvas.offsetLeft,o=t.clientY-this.view.verticalOffset-this.canvas.offsetTop,e=Math.floor(i/this.view.pixelSize),s=Math.floor(o/this.view.pixelSize);try{this.flooder.flood(e,s)}catch(n){if(!n.message.match(/^Not within bounds/))throw n}},o.controllerFor=function(t,i,o){return new h(t,i,o)}}(window.sprite=window.sprite||{});